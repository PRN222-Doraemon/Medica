@using MedicaWeb_MVC.ViewModels.Classes
@model ClassVM

<div class="class-container text-grey border border-secondary-subtle">
    <div class="mb-3">
        <a class="btn btn-outline-warning" asp-controller="Classrooms" asp-action="MyClass">
            <i class="bi bi-arrow-left"></i> Back
        </a>
    </div>
    <div class="d-flex align-items-center mb-4">
        <h1 class="me-3 mb-0 text-orange">@Model.Course.Name</h1>
        <span
            class="badge text-bg-@(Model.Mode == ClassroomMode.Online ? "success" : "body-secondary")">@Model.Mode</span>
    </div>
    <p class="text-grey">@Model.Course.Description</p>
    <p class="text-grey">Total students: @Model.Students.Count() / @Model.MaxParticipant</p>
    <p>@("Start Date: " + Model.StartDate + " - End Date: " + Model.EndDate)</p>

    <!-- nav bar >-->
    <div class="nav-tabs">
        <a href="#" class="nav-item active" data-tab="students">
            <i class="bi bi-people me-2"></i>
            Students
        </a>
        <a href="#" class="nav-item" data-tab="resources">
            <i class="bi bi-book me-2"></i>
            Resource
        </a>
        <a href="#" class="nav-item" data-tab="qa">
            <i class="bi bi-question-circle me-2"></i>
            Q&A
        </a>
    </div>

    <!-- tab content -->
    <div id="tab-content">
        <div class="tab-pane active" id="students-tab">
            @await Html.PartialAsync("~/Views/Classrooms/PartialViews/_StudentsList.cshtml", Model.Students)
        </div>
        <div class="tab-pane" id="resources-tab">
            @await Html.PartialAsync("~/Views/Courses/PartialViews/_CourseContent.cshtml", Model.Course)
        </div>
        <div class="tab-pane" id="qa-tab">
            @await Html.PartialAsync("PartialViews/_CommentsList", Model.Comments)
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const tabs = document.querySelectorAll(".nav-item");
        const tabPanes = document.querySelectorAll(".tab-pane");

        // Lấy tab active từ localStorage hoặc mặc định là "students"
        let activeTab = localStorage.getItem("activeTab") || "students";
        setActiveTab(activeTab);

        // Gán sự kiện click cho mỗi tab
        tabs.forEach(tab => {
            tab.addEventListener("click", function (event) {
                event.preventDefault();
                let selectedTab = this.getAttribute("data-tab");

                // Cập nhật trạng thái active
                setActiveTab(selectedTab);

                // Lưu vào localStorage để nhớ lần sau
                localStorage.setItem("activeTab", selectedTab);
            });
        });

        function setActiveTab(tabName) {
            // Xóa class active khỏi tất cả tab
            tabs.forEach(tab => tab.classList.remove("active"));
            document.querySelector(`.nav-item[data-tab="${tabName}"]`)?.classList.add("active");

            // Ẩn tất cả nội dung
            tabPanes.forEach(pane => pane.classList.remove("active"));

            // Hiển thị tab tương ứng
            document.getElementById(`${tabName}-tab`).classList.add("active");
        }
    });
</script>
